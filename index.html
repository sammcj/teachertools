<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emma's Teacher Tools - GroupThing</title>

  <!-- Styles -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="styles/variables.css">
  <link rel="stylesheet" href="styles/reset.css">
  <link rel="stylesheet" href="styles/utilities.css">
  <link rel="stylesheet" href="styles/layout.css">
  <link rel="stylesheet" href="styles/components.css">
  <link rel="stylesheet" href="styles/student.css">

  <!-- Preload fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <style>
    /* View switching */
    .view {
      display: none;
    }
    .view.active {
      display: block;
    }
    body.student-mode {
      background: linear-gradient(135deg, var(--bg-primary) 0%, #f8f9fa 100%);
    }
  </style>
</head>
<body>
  <!-- Teacher View -->
  <div id="teacher-view" class="view active">
    <div class="app-layout">
      <!-- Header -->
      <header class="app-header">
        <div class="container flex items-center justify-between">
          <div class="flex items-center gap-md">
            <h1 class="text-2xl font-bold">Emma's Teacher Tools</h1>
            <div class="flex gap-sm">
              <a href="timer.html" class="btn btn-sm btn-secondary">
                ‚è±Ô∏è Timer
              </a>
            </div>
          </div>
          <div class="flex gap-sm">
            <button id="export-btn" class="btn btn-sm btn-secondary" title="Export config">
              üíæ Export
            </button>
            <button id="import-btn" class="btn btn-sm btn-secondary" title="Import config">
              üìÇ Import
            </button>
            <button id="switch-to-student-btn" class="btn btn-sm btn-primary">
              üéì Student View
            </button>
          </div>
        </div>
      </header>

      <!-- Main app content -->
      <div class="app-container">
        <!-- Sidebar with class lists -->
        <aside class="app-sidebar">
          <div class="sidebar-inner">
            <div class="panel">
              <h2 class="panel-title mb-md">Class Lists</h2>
              <div id="class-lists" class="stack"></div>
              <div class="divider"></div>
              <div class="stack-sm">
                <button id="new-list-btn" class="btn btn-primary w-full">
                  üÜï New List
                </button>
                <button id="sample-data-btn" class="btn btn-secondary w-full">
                  üìã Load Sample
                </button>
                <button id="clear-all-btn" class="btn btn-sm btn-danger w-full">
                  üóëÔ∏è Clear All
                </button>
              </div>
            </div>
          </div>
        </aside>

        <!-- Main content area -->
        <div class="sidebar-content">
          <!-- Two Column Layout -->
          <div class="grid grid-2 gap-md">
            <!-- Left Column -->
            <div class="stack-lg">
              <!-- Current List Panel -->
              <section class="panel">
                <div class="panel-header flex items-center justify-between">
                  <h2 class="panel-title">
                    <span id="current-list-name">Select a Class List</span>
                  </h2>
                  <select id="list-selector" class="dropdown" style="max-width: 200px;">
                    <option value="">Select a list...</option>
                  </select>
                </div>

                <!-- Group Generation Controls -->
                <div id="group-controls" class="hidden">
                  <div class="stack">
                    <!-- Generate Button and Emoji Toggle -->
                    <div class="flex items-center justify-between gap-md">
                      <button id="generate-btn" class="btn btn-lg btn-primary">
                        üîÑ Generate Groups
                      </button>
                      <label class="checkbox">
                        <input type="checkbox" id="emoji-toggle" checked>
                        <span>Use emoji names</span>
                      </label>
                    </div>

                    <!-- Group Size Slider -->
                    <div>
                      <div class="flex items-center justify-between mb-sm">
                        <label class="font-semibold">Group Size:</label>
                        <span id="group-size-display" class="text-lg font-bold text-primary">3</span>
                      </div>
                      <input
                        type="range"
                        id="group-size-slider"
                        min="1"
                        max="15"
                        value="3"
                        class="w-full"
                        style="accent-color: var(--lavender);">
                      <div class="flex justify-between text-xs text-secondary mt-xs">
                        <span>1</span>
                        <span>15</span>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- Incompatible Pairs Panel -->
              <!-- Incompatible Pairs Panel -->
              <section id="rules-panel" class="panel hidden">
                <div id="rules-header" class="panel-header flex items-center justify-between cursor-pointer">
                  <div class="flex items-center gap-sm">
                    <h2 class="panel-title">Pairing Rules</h2>
                    <span id="rules-count" class="badge">0 rules</span>
                  </div>
                  <span id="rules-toggle" class="text-secondary">‚ñº</span>
                </div>

                <div id="rules-content" class="hidden">
                  <div class="stack">
                    <div id="incompatible-list" class="stack-sm mb-md" style="max-height: 200px; overflow-y: auto;">
                      <!-- Rules will be listed here -->
                    </div>

                    <label class="font-semibold text-sm mb-xs">Add New Rule:</label>

                    <div class="flex gap-sm mb-sm">
                      <label class="checkbox">
                        <input type="radio" name="rule-type" id="rule-type-never" value="never" checked>
                        <span>‚ùå Never together</span>
                      </label>
                      <label class="checkbox">
                        <input type="radio" name="rule-type" id="rule-type-always" value="always">
                        <span>‚úÖ Always together</span>
                      </label>
                    </div>

                    <select id="student-selector" class="dropdown">
                      <option value="">Select students...</option>
                    </select>

                    <div id="selected-students" class="flex flex-wrap gap-sm mb-sm">
                      <!-- Selected students for new rule -->
                    </div>

                    <div class="flex gap-sm">
                      <button id="add-rule-btn" class="btn btn-primary w-full">
                        ‚ûï Add Rule
                      </button>
                      <button id="remove-rule-btn" class="btn btn-danger w-full">
                        ‚ûñ Remove Selected Rules
                      </button>
                    </div>
                  </div>
                </div>
              </section>

              <!-- Generated Groups Panel -->
              <section id="groups-panel" class="panel hidden">
                <h2 class="panel-title mb-md">Generated Groups</h2>
                <div id="groups-preview" class="grid grid-2 gap-md"></div>
              </section>
            </div>

            <!-- Right Column -->
            <div class="stack-lg">
              <!-- Students Panel -->
              <section id="student-panel" class="panel hidden">
                <h2 class="panel-title mb-md">Students</h2>
                <div class="stack">
                  <div class="flex gap-sm">
                    <input
                      type="text"
                      id="student-input"
                      class="input"
                      placeholder="Enter student name (or multiple, comma-separated)"
                      autocomplete="off">
                    <button id="add-student-btn" class="btn btn-primary">
                      ‚ûï Add
                    </button>
                  </div>
                  <div id="student-list" class="grid grid-2 gap-sm"></div>
                  <button id="remove-student-btn" class="btn btn-sm btn-danger w-full">
                    ‚ûñ Remove Selected Students
                  </button>
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Student View -->
  <div id="student-view" class="view">
    <!-- Confetti container -->
    <div id="confetti-container" class="confetti-container"></div>

    <!-- Header -->
    <header class="student-header">
      <div class="container">
        <h1 class="text-3xl font-bold">
          <span id="class-name">Class Groups</span>
        </h1>
        <button id="switch-to-teacher-btn" class="btn btn-sm btn-primary">
          üë®‚Äçüè´ Teacher View
        </button>
      </div>
    </header>

    <!-- Main content -->
    <main class="student-main">
      <div id="groups-container" class="groups-container">
        <!-- Groups will be displayed here -->
      </div>

      <!-- Empty state -->
      <div id="empty-state" class="empty-state hidden">
        <div class="empty-state-icon">üìù</div>
        <p class="empty-state-text">No groups have been generated yet</p>
        <p class="text-secondary">Please generate groups first</p>
      </div>
    </main>
  </div>

  <!-- Modals -->
  <!-- List Modal -->
  <div id="list-modal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="list-modal-close">&times;</span>
      <h3 class="modal-title" id="list-modal-title">Create New Class List</h3>
      <div class="stack">
        <input
          type="text"
          id="list-name-input"
          class="input"
          placeholder="Enter list name"
          autocomplete="off">
        <div class="modal-actions">
          <button id="cancel-list-btn" class="btn btn-secondary">Cancel</button>
          <button id="save-list-btn" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="import-modal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="import-modal-close">&times;</span>
      <div class="modal-header">
        <h2 class="modal-title">Import Settings</h2>
      </div>
      <p class="text-sm text-secondary mb-md">
        Select a backup file to import your class lists and settings.
      </p>
      <div class="stack-sm">
        <input
          type="file"
          id="import-file-input"
          accept=".json"
          class="input">
        <div id="import-error" class="text-error text-sm hidden"></div>
      </div>
      <div class="modal-actions">
        <button id="confirm-import-btn" class="btn btn-primary">üì• Import</button>
        <button id="cancel-import-btn" class="btn btn-secondary">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/storage.js"></script>
  <script src="js/groups.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/teacher.js"></script>
  <script src="js/student.js"></script>
  <script>
    // View switching logic
    const teacherView = document.getElementById('teacher-view');
    const studentView = document.getElementById('student-view');
    const switchToStudentBtn = document.getElementById('switch-to-student-btn');
    const switchToTeacherBtn = document.getElementById('switch-to-teacher-btn');

    function showStudentView() {
      teacherView.classList.remove('active');
      studentView.classList.add('active');
      document.body.classList.add('student-mode');

      // Reload student view
      if (window.studentViewInstance) {
        window.studentViewInstance.loadGroups();
      }
    }

    function showTeacherView() {
      studentView.classList.remove('active');
      teacherView.classList.add('active');
      document.body.classList.remove('student-mode');
    }

    switchToStudentBtn.addEventListener('click', showStudentView);
    switchToTeacherBtn.addEventListener('click', showTeacherView);

    // Store student view instance for reload
    document.addEventListener('DOMContentLoaded', () => {
      // Teacher app is initialized automatically
      // Store student view instance for switching
      setTimeout(() => {
        if (window.studentViewInstance) {
          console.log('Student view instance ready');
        }
      }, 100);
    });
  </script>
</body>
</html>